#include "mainwindow.h"
#include "ui_mainwindow.h"

MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    ui->setupUi(this);
    no_auto_change=true;
}

MainWindow::~MainWindow()
{
    delete ui;
}

void MainWindow::on_pushButton_AddRow_clicked()
{
    ui->tableWidget->setRowCount(ui->tableWidget->rowCount()+1);
    ui->spinBox_Row->setValue(ui->tableWidget->rowCount()+1);
}

void MainWindow::on_pushButton_DellRow_clicked()
{
    int row=ui->tableWidget->rowCount();
    if (row>0)
        ui->tableWidget->setRowCount(row-1);
    ui->spinBox_Row->setValue(row-1);
}

void MainWindow::on_pushButton_AddColumn_clicked()
{
    ui->tableWidget->setColumnCount(ui->tableWidget->columnCount()+1);
    ui->spinBox_Column->setValue(ui->tableWidget->columnCount()+1);
}

void MainWindow::on_pushButton_DellColumn_clicked()
{
    int row=ui->tableWidget->columnCount();
    if (row>0)
        ui->tableWidget->setColumnCount(row-1);
    ui->spinBox_Column->setValue(row-1);
}

void MainWindow::on_spinBox_Row_valueChanged(int arg1)
{
    ui->tableWidget->setRowCount(arg1);
}

void MainWindow::on_spinBox_Column_valueChanged(int arg1)
{
    ui->tableWidget->setColumnCount(arg1);
}

void MainWindow::on_pushButton_Sum_clicked()
{
    no_auto_change=false;
    int row_count=ui->tableWidget->rowCount();
    int column_count=ui->tableWidget->columnCount();
    int sum=0;

    bool flag;

    for (int i=0;i<row_count;i++)
    {
        for (int j=0;j<column_count;j++)
        {
            if (ui->tableWidget->item(i,j)!=nullptr)
            {
                sum+=ui->tableWidget->item(i,j)->text().toInt(&flag);
                if (!flag)
                    ui->tableWidget->item(i,j)->setBackgroundColor(Qt::red);
                else
                    ui->tableWidget->item(i,j)->setBackgroundColor(Qt::white);
            }
            else
            {
                QTableWidgetItem * t1;
                t1 = new QTableWidgetItem;
                ui->tableWidget->setItem(i,j,t1);
                ui->tableWidget->item(i,j)->setBackgroundColor(Qt::magenta);
            }
        }
    }
    ui->label_Sum->setNum(sum);
    no_auto_change=true;
}

void MainWindow::on_pushButton_SetRandom_clicked()
{
    no_auto_change=false;
    int row_count=ui->tableWidget->rowCount();
    int column_count=ui->tableWidget->columnCount();

    for (int i=0;i<row_count;i++)
    {
        for (int j=0;j<column_count;j++)
        {
            if (ui->tableWidget->item(i,j)==nullptr)
            {
                QTableWidgetItem * t1;
                t1 = new QTableWidgetItem;
                ui->tableWidget->setItem(i,j,t1);
            }
            ui->tableWidget->item(i,j)->setText(QString::number(rand()%499-500));
            ui->tableWidget->item(i,j)->setBackgroundColor(Qt::white);
        }
    }
    no_auto_change=true;
}

void MainWindow::on_tableWidget_cellChanged(int row, int column)
{
    if (no_auto_change)
    {
        bool flag;
        ui->tableWidget->item(row,column)->text().toInt(&flag);
        if (!flag)
            ui->tableWidget->item(row,column)->setBackgroundColor(Qt::red);
        else
            ui->tableWidget->item(row,column)->setBackgroundColor(Qt::white);
    }
}